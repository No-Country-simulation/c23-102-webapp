<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Horarios</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <h1>Gestión de Horarios</h1>

    <!-- Tabla para listar horarios -->
    <h2>Horarios Existentes</h2>
    <table border="1">
        <thead>
            <tr>
                <th>Día</th>
                <th>Hora Apertura</th>
                <th>Hora Cierre</th>
                <th>Estado</th>
            </tr>
        </thead>
        <tbody id="horarios-list">
            <!-- Los datos serán llenados dinámicamente -->
        </tbody>
    </table>

    <!-- Formulario para agregar un nuevo horario -->
    <h2>Agregar Nuevo Horario</h2>
    <form id="horario-form">
        <label for="dia">Día:</label>
        <select id="dia" name="dia">
            <option value="Lunes">Lunes</option>
            <option value="Martes">Martes</option>
            <option value="Miércoles">Miércoles</option>
            <option value="Jueves">Jueves</option>
            <option value="Viernes">Viernes</option>
            <option value="Sábado">Sábado</option>
            <option value="Domingo">Domingo</option>
        </select>
        <br>

        <label for="hora_apertura">Hora Apertura:</label>
        <input type="number" id="hora_apertura" name="hora_apertura" min="0" max="23">
        <br>

        <label for="hora_cierre">Hora Cierre:</label>
        <input type="number" id="hora_cierre" name="hora_cierre" min="0" max="23">
        <br>

        <label for="estado">Estado:</label>
        <select id="estado" name="estado">
            <option value="1">Abierto</option>
            <option value="0">Cerrado</option>
        </select>
        <br>

        <button type="button" onclick="agregarHorario()">Agregar Horario</button>
    </form>

    <script>
        const idRestaurante = 1; // Puedes reemplazarlo dinámicamente según el restaurante actual.

        // Función para cargar los horarios
        function cargarHorarios() {
            fetch(`/horarios/${idRestaurante}`)
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('horarios-list');
                    tbody.innerHTML = '';
                    data.forEach(horario => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${horario[2]}</td>
                            <td>${horario[3]}</td>
                            <td>${horario[4]}</td>
                            <td>${horario[5] ? 'Abierto' : 'Cerrado'}</td>
                        `;
                        tbody.appendChild(row);
                    });
                })
                .catch(error => console.error('Error al cargar los horarios:', error));
        }

        // Función para agregar un nuevo horario
        function agregarHorario() {
            const dia = document.getElementById('dia').value;
            const horaApertura = document.getElementById('hora_apertura').value;
            const horaCierre = document.getElementById('hora_cierre').value;
            const estado = document.getElementById('estado').value;

            fetch('/horarios/nuevo', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    ID_Restaurante: idRestaurante,
                    Dia: dia,
                    Hora_Apertura: parseInt(horaApertura),
                    Hora_Cierre: parseInt(horaCierre),
                    Estado: estado === '1',
                }),
            })
                .then(response => response.json())
                .then(data => {
                    alert(data.mensaje || data.error);
                    cargarHorarios();
                })
                .catch(error => console.error('Error al agregar el horario:', error));
        }

        // Cargar horarios al cargar la página
        window.onload = cargarHorarios;
    </script>
</body>
</html>
